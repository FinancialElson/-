<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>極簡退休複利模擬器</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2563eb; --secondary: #f59e0b; --danger: #ef4444; --bg: #f8fafc; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); padding: 15px; margin: 0; }
        .container { display: grid; grid-template-columns: 360px 1fr; gap: 20px; max-width: 1400px; margin: 0 auto; }
        .card { background: white; padding: 1.5rem; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        h3 { margin: 15px 0 10px 0; color: #1e293b; font-size: 1rem; border-left: 4px solid var(--primary); padding-left: 10px; }
        .input-group { margin-bottom: 0.8rem; }
        label { display: block; font-size: 0.8rem; font-weight: 600; color: #64748b; margin-bottom: 4px; }
        input { width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; font-size: 1rem; transition: border 0.2s; }
        input:focus { border-color: var(--primary); outline: none; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .stat-item { background: #f8fafc; padding: 12px; border-radius: 12px; text-align: center; border: 1px solid #f1f5f9; }
        .stat-val { font-size: 1.1rem; font-weight: bold; color: var(--primary); }
        
        .chart-container { position: relative; height: 550px; width: 100%; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } .chart-container { height: 50vh; } }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h3>1. 累積階段 (壯年期)</h3>
        <div class="input-group">
            <label>年齡 (現在 / 退休)</label>
            <div style="display: flex; gap: 8px;">
                <input type="number" id="currentAge" value="30" oninput="runSimulation()">
                <input type="number" id="retireAge" value="65" oninput="runSimulation()">
            </div>
        </div>
        <div class="input-group">
            <label>初始本金 / 每月投入 ($)</label>
            <div style="display: flex; gap: 8px;">
                <input type="number" id="principal" value="100000" oninput="runSimulation()">
                <input type="number" id="monthly" value="20000" oninput="runSimulation()">
            </div>
        </div>
        <div class="input-group">
            <label>預期年化報酬率 (%)</label>
            <input type="number" id="returnRate" value="8" step="0.5" oninput="runSimulation()">
        </div>

        <h3>2. 提領階段 (退休期)</h3>
        <div class="input-group">
            <label>每月生活費 / 政府年金 ($)</label>
            <div style="display: flex; gap: 8px;">
                <input type="number" id="retireExpense" value="60000" oninput="runSimulation()">
                <input type="number" id="pension" value="25000" oninput="runSimulation()">
            </div>
        </div>
        <div class="input-group">
            <label>預期長期通膨率 (%)</label>
            <input type="number" id="inflation" value="2.5" step="0.1" oninput="runSimulation()">
        </div>

        <div class="stat-grid">
            <div class="stat-item">
                <label>退休時總資產</label>
                <div id="atRetire" class="stat-val">$0</div>
            </div>
            <div class="stat-item">
                <label>預估壽命</label>
                <div id="depletionAge" class="stat-val" style="color:var(--secondary)">100+</div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="chart-container">
            <canvas id="mainChart"></canvas>
        </div>
    </div>
</div>

<script>
let chart;

function runSimulation() {
    const curAge = parseInt(document.getElementById('currentAge').value) || 0;
    const retAge = parseInt(document.getElementById('retireAge').value) || 0;
    const P = parseFloat(document.getElementById('principal').value) || 0;
    const PMT = parseFloat(document.getElementById('monthly').value) || 0;
    const rate = (parseFloat(document.getElementById('returnRate').value) || 0) / 100;
    const expense = parseFloat(document.getElementById('retireExpense').value) || 0;
    const pension = parseFloat(document.getElementById('pension').value) || 0;
    const inf = (parseFloat(document.getElementById('inflation').value) || 0) / 100;

    const mRate = rate / 12;
    let labels = [], data = [], currentBalance = P;
    let depletionAge = null;

    labels.push(`${curAge}歲`);
    data.push(Math.round(currentBalance));

    for (let age = curAge + 1; age <= 100; age++) {
        if (age <= retAge) {
            for (let m = 1; m <= 12; m++) {
                currentBalance = (currentBalance + PMT) * (1 + mRate);
            }
        } else {
            const adjustedShortfall = (expense - pension) * 12 * Math.pow(1 + inf, age - curAge);
            currentBalance = (currentBalance - adjustedShortfall) * (1 + rate);
        }

        labels.push(`${age}歲`);
        const roundedBalance = Math.max(0, Math.round(currentBalance));
        data.push(roundedBalance);

        if (roundedBalance === 0 && depletionAge === null) {
            depletionAge = age;
        }
    }

    document.getElementById('atRetire').innerText = `$ ${(data[retAge - curAge] || 0).toLocaleString()}`;
    document.getElementById('depletionAge').innerText = depletionAge ? `${depletionAge} 歲` : "100+ 歲";

    if (chart) chart.destroy();
    const ctx = document.getElementById('mainChart').getContext('2d');
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: '資產價值軌跡',
                data: data,
                borderColor: '#2563eb',
                borderWidth: 3,
                pointRadius: 0, // 移除點
                pointHitRadius: 10, // 增加懸停感應範圍以便顯示 Tooltip
                fill: true,
                backgroundColor: 'rgba(37, 99, 235, 0.05)',
                tension: 0.4, // 增加線條平滑感
                segment: {
                    borderColor: ctx => ctx.p0.parsed.x + curAge >= retAge ? '#ef4444' : '#2563eb',
                }
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: { 
                    mode: 'index', 
                    intersect: false,
                    callbacks: {
                        label: (ctx) => `資產: $${ctx.raw.toLocaleString()}`
                    }
                }
            },
            scales: {
                y: { 
                    beginAtZero: true, 
                    ticks: { 
                        font: { size: 11 },
                        callback: v => '$' + v.toLocaleString() 
                    } 
                },
                x: {
                    ticks: { maxTicksLimit: 12, font: { size: 11 } }
                }
            }
        }
    });
}
runSimulation();
</script>
</body>
</html>
